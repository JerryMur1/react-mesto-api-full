{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/dmitrii/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\nimport ImagePopup from \"./PopupImage\";\nimport React from \"react\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from '../context/CurrentUserContext';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as mestoAuth from \"../mestoAuth\";\nimport InfoToolTip from \"./InfoToolTip\";\n\nfunction App() {\n  _s();\n\n  const [cards, setCards] = React.useState([]);\n  const history = useHistory();\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [userData, setUserData] = React.useState('');\n\n  function handleUpdateUser({\n    name,\n    about\n  }) {\n    api.addUserId({\n      name,\n      about\n    }).then(res => {\n      setCurrentUser({\n        name: res.name,\n        about: res.about,\n        avatar: res.avatar\n      });\n    }).catch(res => {\n      console.log(res);\n    }).finally(() => {\n      closeAllPopups();\n    });\n  }\n\n  ;\n\n  function handleUpdateAvatar({\n    avatar\n  }) {\n    api.addAvatarId({\n      avatar\n    }).then(res => {\n      setCurrentUser({\n        avatar: res.avatar,\n        name: res.name,\n        about: res.about\n      });\n    }).catch(res => {\n      console.log(res);\n    }).finally(() => {\n      closeAllPopups();\n    });\n  }\n\n  ;\n  React.useEffect(() => {\n    api.getUserId().then(res => {\n      setCurrentUser({\n        name: res.name,\n        about: res.about,\n        avatar: res.avatar,\n        _id: res._id\n      });\n    }).catch(res => {\n      console.log(res);\n    });\n  }, []);\n  React.useEffect(() => {\n    api.getInitialCards().then(item => {\n      setCards(item);\n    }).catch(res => {\n      console.log(res);\n    });\n  }, []);\n\n  function handleAddPlaceSubmit({\n    name,\n    link\n  }) {\n    api.addCards({\n      name,\n      link\n    }).then(newCard => {\n      setCards([newCard, ...cards]);\n    }).catch(res => {\n      console.log(res);\n    }).finally(() => {\n      closeAllPopups();\n    });\n    ;\n  }\n\n  ;\n\n  function handleDeleteCard({\n    cardId\n  }) {\n    api.deleteCard(cardId).then(() => {\n      const newCards = cards.filter(card => card._id !== cardId);\n      setCards(newCards);\n    });\n  }\n\n  function handleCardLike({\n    likes,\n    cardId\n  }) {\n    const isLiked = likes.some(i => {\n      return i._id === currentUser._id;\n    });\n    api.likeCard(cardId, !isLiked).then(newCard => {\n      console.log(isLiked);\n      const newCards = cards.map(c => {\n        return c._id === cardId ? newCard : c;\n      });\n      setCards(newCards);\n    });\n  }\n\n  console.log(cards);\n  const [isEditProfilePopupOpen, editOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, avatarOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, placeOpen] = React.useState(false);\n  const [card, selectedCard] = React.useState(null);\n  const [isInfoToolTipOpen, toolOpen] = React.useState(false);\n  const [status, setStatus] = React.useState(false);\n\n  const handleCardClick = ({\n    link,\n    name\n  }) => {\n    selectedCard({\n      link,\n      name\n    });\n  };\n\n  function handleInfoToolClick() {\n    toolOpen(true);\n  }\n\n  function handleEditEditClick() {\n    editOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    avatarOpen(true);\n  }\n\n  function handleEditAddClick() {\n    placeOpen(true);\n  }\n\n  function closeAllPopups() {\n    placeOpen(false);\n    avatarOpen(false);\n    editOpen(false);\n    toolOpen(false);\n    selectedCard(null);\n  }\n\n  const tokenCheck = () => {\n    const jwt = localStorage.getItem('token');\n\n    if (jwt) {\n      mestoAuth.getContent(jwt).then(res => {\n        console.log(res);\n\n        if (res) {\n          setUserData({ ...userData,\n            email: res.data.email\n          });\n          setLoggedIn(true);\n        }\n      }).catch(e => console.error(e));\n    } else {\n      setLoggedIn(false);\n    }\n  };\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, []);\n  React.useEffect(() => {\n    if (loggedIn) {\n      history.push('/');\n    }\n  }, [loggedIn]);\n\n  const handleRegister = (email, password) => {\n    mestoAuth.register(email, password).then(res => {\n      console.log(res);\n\n      if (res.statusCode !== 400) {\n        setStatus(true);\n        history.push('/signin');\n      } else {\n        throw new Error('Что-то пошло не так');\n      }\n    }).catch(e => console.log(e));\n  };\n\n  const handleLogin = (email, password) => {\n    mestoAuth.authorize(email, password).then(data => {\n      if (data.token) {\n        history.push('/');\n        localStorage.setItem('token', data.token);\n        setLoggedIn(true);\n        setUserData({ ...userData,\n          email: data.user.email\n        });\n      }\n\n      if (data.statusCode === 400) {\n        throw new Error('Что-то пошло не так');\n      }\n    }).catch(e => console.log(e));\n  };\n\n  const handleSignOut = () => {\n    setLoggedIn(false);\n    localStorage.removeItem('token');\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n      value: currentUser,\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        handleSignOut: handleSignOut,\n        email: userData.email\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(Switch, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: \"/signin\",\n          children: /*#__PURE__*/_jsxDEV(Login, {\n            handleLogin: handleLogin\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 9\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/signup\",\n          children: /*#__PURE__*/_jsxDEV(Register, {\n            handleRegister: handleRegister,\n            showPopup: handleInfoToolClick\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n          path: \"/\",\n          component: Main,\n          handleSignOut: handleSignOut,\n          onCardClick: handleCardClick,\n          onEditProfile: handleEditEditClick,\n          onAddPlace: handleEditAddClick,\n          onEditAvatar: handleEditAvatarClick,\n          cards: cards,\n          onCardLike: handleCardLike,\n          handleDeleteCard: handleDeleteCard,\n          loggedIn: loggedIn\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        onClose: closeAllPopups,\n        onUpdatePlace: handleAddPlaceSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        onClose: closeAllPopups,\n        onUpdateAvatar: handleUpdateAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        onClose: closeAllPopups,\n        onUpdateUser: handleUpdateUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(InfoToolTip, {\n        onClose: closeAllPopups,\n        isOpen: isInfoToolTipOpen,\n        status: status\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n        card: card,\n        onClose: closeAllPopups\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 209,\n    columnNumber: 7\n  }, this);\n}\n\n_s(App, \"/z+bfa3iWKbifZ6AhHw8cmV4J8A=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/dmitrii/react-mesto-auth/src/components/App.js"],"names":["Main","Footer","Header","ImagePopup","React","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Route","Switch","useHistory","Login","Register","ProtectedRoute","mestoAuth","InfoToolTip","App","cards","setCards","useState","history","currentUser","setCurrentUser","loggedIn","setLoggedIn","userData","setUserData","handleUpdateUser","name","about","addUserId","then","res","avatar","catch","console","log","finally","closeAllPopups","handleUpdateAvatar","addAvatarId","useEffect","getUserId","_id","getInitialCards","item","handleAddPlaceSubmit","link","addCards","newCard","handleDeleteCard","cardId","deleteCard","newCards","filter","card","handleCardLike","likes","isLiked","some","i","likeCard","map","c","isEditProfilePopupOpen","editOpen","isEditAvatarPopupOpen","avatarOpen","isAddPlacePopupOpen","placeOpen","selectedCard","isInfoToolTipOpen","toolOpen","status","setStatus","handleCardClick","handleInfoToolClick","handleEditEditClick","handleEditAvatarClick","handleEditAddClick","tokenCheck","jwt","localStorage","getItem","getContent","email","data","e","error","push","handleRegister","password","register","statusCode","Error","handleLogin","authorize","token","setItem","user","handleSignOut","removeItem"],"mappings":"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","sourcesContent":["import Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\nimport ImagePopup from \"./PopupImage\";\nimport React from \"react\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from '../context/CurrentUserContext'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\"\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as mestoAuth from \"../mestoAuth\"\nimport InfoToolTip from \"./InfoToolTip\";\n\nfunction App() {\n \n  const [cards, setCards] = React.useState([]);\n  const history = useHistory();\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false)\n  const [userData, setUserData] = React.useState('')\n  \n  function handleUpdateUser({name, about}){\n \n      api.addUserId({name, about}).then((res) => {\n        setCurrentUser({\n          name: res.name, about:res.about, avatar: res.avatar})\n      }).catch((res)=>{\n        console.log(res)\n      }).finally(()=>{\n        closeAllPopups()\n      });\n    };\n\n    \n    function handleUpdateAvatar({avatar}){\n \n      api.addAvatarId({avatar}).then((res) => {\n        setCurrentUser({\n   avatar: res.avatar, name: res.name, about:res.about})\n      }).catch((res)=>{\n        console.log(res)\n      }).finally(()=>{\n        closeAllPopups()\n      });\n    };\n\n \n  React.useEffect(() => {\n    api.getUserId().then((res) => {\n      setCurrentUser({\n        name: res.name,\n        about: res.about,\n        avatar: res.avatar,\n        _id: res._id\n      })\n    }).catch((res)=>{\n      console.log(res)\n    });\n  }, []);\n\n\n\n\n  React.useEffect(() => {\n    api.getInitialCards().then((item) => {\n      setCards(item);\n    }).catch((res)=>{\n      console.log(res)\n    });\n  }, []);\n  \nfunction handleAddPlaceSubmit({name, link}){\n  api.addCards({name, link}).then(newCard => {\n    setCards([newCard, ...cards]);\n  }).catch((res)=>{\n    console.log(res)\n  }).finally(()=>{\n    closeAllPopups()\n  });;\n};\n\n\nfunction handleDeleteCard({cardId}) {\n  \n  api.deleteCard(cardId).then(() => {\n    const newCards = cards.filter(card => card._id !== cardId);\n    setCards(newCards);\n  });\n}\n\n\n  function handleCardLike({likes, cardId}) {\n    const isLiked = likes.some(i => {return i._id === currentUser._id});\n  \n    api.likeCard(cardId, !isLiked).then((newCard) => {\n      console.log(isLiked)\n      const newCards = cards.map((c) => {return c._id === cardId ? newCard : c});\n      setCards(newCards);\n    });\n}\n\n\nconsole.log(cards)\n  const [isEditProfilePopupOpen, editOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, avatarOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, placeOpen] = React.useState(false);\n  const [card, selectedCard] = React.useState(null);\n  const [isInfoToolTipOpen, toolOpen] = React.useState(false);\n  const [status, setStatus] = React.useState(false)\n  const handleCardClick = ({link, name}) => {\n    selectedCard({link, name});\n  };\n  function handleInfoToolClick () {\n    toolOpen(true)\n  }\n  function handleEditEditClick() {\n    editOpen(true);\n  }\n  function handleEditAvatarClick() {\n    avatarOpen(true);\n  }\n  function handleEditAddClick() {\n    placeOpen(true);\n  }\n  function closeAllPopups() {\n    placeOpen(false);\n    avatarOpen(false);\n    editOpen(false);\n    toolOpen(false)\n    selectedCard(null);\n  }\nconst tokenCheck = () =>{\n  const jwt = localStorage.getItem('token')\n  if (jwt) {\n    \n    mestoAuth.getContent(jwt)\n    .then((res) =>{\n      console.log(res)\n      if(res){\n        setUserData({\n          ...userData,\n          email: res.data.email,\n        })\n        setLoggedIn(true)\n      }\n    })\n    .catch(e => console.error(e))\n  }\n  else {\n    setLoggedIn(false)\n  }\n  \n}\nReact.useEffect(() =>{\n  tokenCheck();\n}, [])\nReact.useEffect(() =>{\n  if(loggedIn){\n    history.push('/')\n  }\n}, [loggedIn])\n\n  const handleRegister = (email, password) => {\n    \n    mestoAuth.register(email, password)\n    .then((res) =>{\n      console.log(res)\n      if(res.statusCode !== 400){\n        setStatus(true)\n        history.push('/signin')\n      }\n      else {\n        throw new Error('Что-то пошло не так')\n      }\n     \n    })\n    .catch((e) => console.log(e));\n  }\n  const handleLogin = (email, password) =>{\n    mestoAuth.authorize(email, password)\n.then((data) => {\n \n  if(data.token){\n    history.push('/')\n  localStorage.setItem('token', data.token)\n  setLoggedIn(true)\n  setUserData({\n    ...userData,\n    email: data.user.email,\n  })\n  }\n  if(data.statusCode === 400){\n    throw new Error('Что-то пошло не так')\n  }\n})\n.catch((e) => console.log(e));\n  }\n\nconst handleSignOut = () =>{\n  setLoggedIn(false)\n  localStorage.removeItem('token')\n}\n\n  return (\n      <div className=\"page\">\n   <CurrentUserContext.Provider value={currentUser}>\n   <Header handleSignOut={handleSignOut} email={userData.email}/>\n     <Switch>\n      <Route path=\"/signin\" >\n        <Login handleLogin={handleLogin}/>  \n     </Route>\n        <Route path=\"/signup\" >\n          <Register handleRegister={handleRegister} showPopup={handleInfoToolClick}/>\n        </Route>\n        <ProtectedRoute path=\"/\" component={Main} \n        handleSignOut = {handleSignOut}\n        onCardClick={handleCardClick}\n          onEditProfile={handleEditEditClick}\n          onAddPlace={handleEditAddClick}\n          onEditAvatar={handleEditAvatarClick}\n          cards={cards}\n          onCardLike={handleCardLike}\n          handleDeleteCard={handleDeleteCard}\n          loggedIn={loggedIn}/>\n     </Switch>\n        <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onUpdatePlace={handleAddPlaceSubmit}/>\n       <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar}/>\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser}/>\n       <InfoToolTip onClose={closeAllPopups} isOpen={isInfoToolTipOpen} status={status}/>\n        <ImagePopup card={card} onClose={closeAllPopups} />\n        <Footer />\n       \n        </CurrentUserContext.Provider>\n        \n      </div>\n   \n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}