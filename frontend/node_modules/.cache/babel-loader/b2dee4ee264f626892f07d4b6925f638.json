{"ast":null,"code":"import _objectSpread from\"/Users/dmitrii/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/dmitrii/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/dmitrii/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import Main from\"./Main\";import Footer from\"./Footer\";import Header from\"./Header\";import ImagePopup from\"./PopupImage\";import React from\"react\";import api from\"../utils/api\";import{CurrentUserContext}from'../context/CurrentUserContext';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import{Route,Switch,useHistory}from\"react-router-dom\";import Login from\"./Login\";import Register from\"./Register\";import ProtectedRoute from\"./ProtectedRoute\";import*as mestoAuth from\"../mestoAuth\";import InfoToolTip from\"./InfoToolTip\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),cards=_React$useState2[0],setCards=_React$useState2[1];var history=useHistory();var _React$useState3=React.useState({}),_React$useState4=_slicedToArray(_React$useState3,2),currentUser=_React$useState4[0],setCurrentUser=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),loggedIn=_React$useState6[0],setLoggedIn=_React$useState6[1];var _React$useState7=React.useState(''),_React$useState8=_slicedToArray(_React$useState7,2),userData=_React$useState8[0],setUserData=_React$useState8[1];function handleUpdateUser(_ref){var name=_ref.name,about=_ref.about;api.addUserId({name:name,about:about}).then(function(res){setCurrentUser({name:res.name,about:res.about,avatar:res.avatar});}).catch(function(res){console.log(res);}).finally(function(){closeAllPopups();});};function handleUpdateAvatar(_ref2){var avatar=_ref2.avatar;api.addAvatarId({avatar:avatar}).then(function(res){setCurrentUser({avatar:res.avatar,name:res.name,about:res.about});}).catch(function(res){console.log(res);}).finally(function(){closeAllPopups();});};React.useEffect(function(){api.getUserId().then(function(res){if(!loggedIn){return;}setCurrentUser({name:res.name,about:res.about,avatar:res.avatar,_id:res._id});}).catch(function(res){console.log(res);});},[loggedIn]);React.useEffect(function(){api.getInitialCards().then(function(item){if(!loggedIn){return;}setCards(item);console.log(item);}).catch(function(res){console.log(res);});},[loggedIn]);function handleAddPlaceSubmit(_ref3){var name=_ref3.name,link=_ref3.link;api.addCards({name:name,link:link}).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));}).catch(function(res){console.log(res);}).finally(function(){closeAllPopups();});;};function handleDeleteCard(_ref4){var cardId=_ref4.cardId;api.deleteCard(cardId).then(function(){var newCards=cards.filter(function(card){return card._id!==cardId;});setCards(newCards);});}function handleCardLike(_ref5){var likes=_ref5.likes,cardId=_ref5.cardId;var isLiked=likes.some(function(i){return i===currentUser._id;});api.likeCard(cardId,!isLiked).then(function(newCard){console.log(isLiked);var newCards=cards.map(function(c){return c._id===cardId?newCard:c;});setCards(newCards);});}console.log(cards);var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isEditProfilePopupOpen=_React$useState10[0],editOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isEditAvatarPopupOpen=_React$useState12[0],avatarOpen=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isAddPlacePopupOpen=_React$useState14[0],placeOpen=_React$useState14[1];var _React$useState15=React.useState(null),_React$useState16=_slicedToArray(_React$useState15,2),card=_React$useState16[0],selectedCard=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isInfoToolTipOpen=_React$useState18[0],toolOpen=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),status=_React$useState20[0],setStatus=_React$useState20[1];var handleCardClick=function handleCardClick(_ref6){var link=_ref6.link,name=_ref6.name;selectedCard({link:link,name:name});};function handleInfoToolClick(){toolOpen(true);}function handleEditEditClick(){editOpen(true);}function handleEditAvatarClick(){avatarOpen(true);}function handleEditAddClick(){placeOpen(true);}function closeAllPopups(){placeOpen(false);avatarOpen(false);editOpen(false);toolOpen(false);selectedCard(null);}var tokenCheck=function tokenCheck(){var token=localStorage.getItem('token');if(token){mestoAuth.getContent(token).then(function(res){console.log(res);if(res){setUserData(_objectSpread(_objectSpread({},userData),{},{email:res.email}));setLoggedIn(true);}}).catch(function(e){return console.error(e);});}else{setLoggedIn(false);}};React.useEffect(function(){tokenCheck();},[]);React.useEffect(function(){if(loggedIn){history.push('/');}},[history,loggedIn]);var handleRegister=function handleRegister(email,password){mestoAuth.register(email,password).then(function(res){console.log(res);if(res.statusCode!==400){setStatus(true);history.push('/signin');}else{throw new Error('Что-то пошло не так');}}).catch(function(e){return console.log(e);});};var handleLogin=function handleLogin(email,password){mestoAuth.authorize(email,password).then(function(data){console.log(data);if(data.token){history.push('/');localStorage.setItem('token',data.token);console.log(data);setLoggedIn(true);setUserData(_objectSpread(_objectSpread({},userData),{},{email:data.email}));}if(data.statusCode===400){throw new Error('Что-то пошло не так');}}).catch(function(e){return console.log(e);});};var handleSignOut=function handleSignOut(){setLoggedIn(false);localStorage.removeItem('token');};return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{handleSignOut:handleSignOut,email:userData.email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{handleRegister:handleRegister,showPopup:handleInfoToolClick})}),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/\",component:Main,handleSignOut:handleSignOut,onCardClick:handleCardClick,onEditProfile:handleEditEditClick,onAddPlace:handleEditAddClick,onEditAvatar:handleEditAvatarClick,cards:cards,onCardLike:handleCardLike,handleDeleteCard:handleDeleteCard,loggedIn:loggedIn})]}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onUpdatePlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(InfoToolTip,{onClose:closeAllPopups,isOpen:isInfoToolTipOpen,status:status}),/*#__PURE__*/_jsx(ImagePopup,{card:card,onClose:closeAllPopups}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["/Users/dmitrii/react-mesto-api-full/frontend/src/components/App.js"],"names":["Main","Footer","Header","ImagePopup","React","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Route","Switch","useHistory","Login","Register","ProtectedRoute","mestoAuth","InfoToolTip","App","useState","cards","setCards","history","currentUser","setCurrentUser","loggedIn","setLoggedIn","userData","setUserData","handleUpdateUser","name","about","addUserId","then","res","avatar","catch","console","log","finally","closeAllPopups","handleUpdateAvatar","addAvatarId","useEffect","getUserId","_id","getInitialCards","item","handleAddPlaceSubmit","link","addCards","newCard","handleDeleteCard","cardId","deleteCard","newCards","filter","card","handleCardLike","likes","isLiked","some","i","likeCard","map","c","isEditProfilePopupOpen","editOpen","isEditAvatarPopupOpen","avatarOpen","isAddPlacePopupOpen","placeOpen","selectedCard","isInfoToolTipOpen","toolOpen","status","setStatus","handleCardClick","handleInfoToolClick","handleEditEditClick","handleEditAvatarClick","handleEditAddClick","tokenCheck","token","localStorage","getItem","getContent","email","e","error","push","handleRegister","password","register","statusCode","Error","handleLogin","authorize","data","setItem","handleSignOut","removeItem"],"mappings":"gfAAA,MAAOA,CAAAA,IAAP,KAAiB,QAAjB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,GAAP,KAAgB,cAAhB,CACA,OAASC,kBAAT,KAAmC,+BAAnC,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,OAASC,KAAT,CAAgBC,MAAhB,CAAwBC,UAAxB,KAA0C,kBAA1C,CACA,MAAOC,CAAAA,KAAP,KAAkB,SAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAO,GAAKC,CAAAA,SAAZ,KAA2B,cAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,C,wFAEA,QAASC,CAAAA,GAAT,EAAe,qBAEad,KAAK,CAACe,QAAN,CAAe,EAAf,CAFb,oDAENC,KAFM,qBAECC,QAFD,qBAGb,GAAMC,CAAAA,OAAO,CAAGV,UAAU,EAA1B,CAHa,qBAIyBR,KAAK,CAACe,QAAN,CAAe,EAAf,CAJzB,qDAINI,WAJM,qBAIOC,cAJP,0CAKmBpB,KAAK,CAACe,QAAN,CAAe,KAAf,CALnB,qDAKNM,QALM,qBAKIC,WALJ,0CAMmBtB,KAAK,CAACe,QAAN,CAAe,EAAf,CANnB,qDAMNQ,QANM,qBAMIC,WANJ,qBAQb,QAASC,CAAAA,gBAAT,MAAwC,IAAbC,CAAAA,IAAa,MAAbA,IAAa,CAAPC,KAAO,MAAPA,KAAO,CAEpC1B,GAAG,CAAC2B,SAAJ,CAAc,CAACF,IAAI,CAAJA,IAAD,CAAOC,KAAK,CAALA,KAAP,CAAd,EAA6BE,IAA7B,CAAkC,SAACC,GAAD,CAAS,CACzCV,cAAc,CAAC,CACbM,IAAI,CAAEI,GAAG,CAACJ,IADG,CACGC,KAAK,CAACG,GAAG,CAACH,KADb,CACoBI,MAAM,CAAED,GAAG,CAACC,MADhC,CAAD,CAAd,CAED,CAHD,EAGGC,KAHH,CAGS,SAACF,GAAD,CAAO,CACdG,OAAO,CAACC,GAAR,CAAYJ,GAAZ,EACD,CALD,EAKGK,OALH,CAKW,UAAI,CACbC,cAAc,GACf,CAPD,EAQD,EAGD,QAASC,CAAAA,kBAAT,OAAqC,IAARN,CAAAA,MAAQ,OAARA,MAAQ,CAEnC9B,GAAG,CAACqC,WAAJ,CAAgB,CAACP,MAAM,CAANA,MAAD,CAAhB,EAA0BF,IAA1B,CAA+B,SAACC,GAAD,CAAS,CACtCV,cAAc,CAAC,CACpBW,MAAM,CAAED,GAAG,CAACC,MADQ,CACAL,IAAI,CAAEI,GAAG,CAACJ,IADV,CACgBC,KAAK,CAACG,GAAG,CAACH,KAD1B,CAAD,CAAd,CAED,CAHD,EAGGK,KAHH,CAGS,SAACF,GAAD,CAAO,CACdG,OAAO,CAACC,GAAR,CAAYJ,GAAZ,EACD,CALD,EAKGK,OALH,CAKW,UAAI,CACbC,cAAc,GACf,CAPD,EAQD,EAGHpC,KAAK,CAACuC,SAAN,CAAgB,UAAM,CACpBtC,GAAG,CAACuC,SAAJ,GAAgBX,IAAhB,CAAqB,SAACC,GAAD,CAAS,CAC5B,GAAI,CAACT,QAAL,CAAe,CACb,OACD,CACDD,cAAc,CAAC,CACbM,IAAI,CAAEI,GAAG,CAACJ,IADG,CAEbC,KAAK,CAAEG,GAAG,CAACH,KAFE,CAGbI,MAAM,CAAED,GAAG,CAACC,MAHC,CAIbU,GAAG,CAAEX,GAAG,CAACW,GAJI,CAAD,CAAd,CAOD,CAXD,EAWGT,KAXH,CAWS,SAACF,GAAD,CAAO,CACdG,OAAO,CAACC,GAAR,CAAYJ,GAAZ,EACD,CAbD,EAcD,CAfD,CAeG,CAACT,QAAD,CAfH,EAoBArB,KAAK,CAACuC,SAAN,CAAgB,UAAM,CACpBtC,GAAG,CAACyC,eAAJ,GAAsBb,IAAtB,CAA2B,SAACc,IAAD,CAAU,CACnC,GAAI,CAACtB,QAAL,CAAe,CACb,OACD,CACDJ,QAAQ,CAAC0B,IAAD,CAAR,CACAV,OAAO,CAACC,GAAR,CAAYS,IAAZ,EACD,CAND,EAMGX,KANH,CAMS,SAACF,GAAD,CAAO,CACdG,OAAO,CAACC,GAAR,CAAYJ,GAAZ,EACD,CARD,EASD,CAVD,CAUG,CAACT,QAAD,CAVH,EAYF,QAASuB,CAAAA,oBAAT,OAA2C,IAAZlB,CAAAA,IAAY,OAAZA,IAAY,CAANmB,IAAM,OAANA,IAAM,CACzC5C,GAAG,CAAC6C,QAAJ,CAAa,CAACpB,IAAI,CAAJA,IAAD,CAAOmB,IAAI,CAAJA,IAAP,CAAb,EAA2BhB,IAA3B,CAAgC,SAAAkB,OAAO,CAAI,CACzC9B,QAAQ,EAAE8B,OAAF,4BAAc/B,KAAd,GAAR,CACD,CAFD,EAEGgB,KAFH,CAES,SAACF,GAAD,CAAO,CACdG,OAAO,CAACC,GAAR,CAAYJ,GAAZ,EACD,CAJD,EAIGK,OAJH,CAIW,UAAI,CACbC,cAAc,GACf,CAND,EAMG,CACJ,EAGD,QAASY,CAAAA,gBAAT,OAAoC,IAATC,CAAAA,MAAS,OAATA,MAAS,CAElChD,GAAG,CAACiD,UAAJ,CAAeD,MAAf,EAAuBpB,IAAvB,CAA4B,UAAM,CAChC,GAAMsB,CAAAA,QAAQ,CAAGnC,KAAK,CAACoC,MAAN,CAAa,SAAAC,IAAI,QAAIA,CAAAA,IAAI,CAACZ,GAAL,GAAaQ,MAAjB,EAAjB,CAAjB,CACAhC,QAAQ,CAACkC,QAAD,CAAR,CACD,CAHD,EAID,CAGC,QAASG,CAAAA,cAAT,OAAyC,IAAhBC,CAAAA,KAAgB,OAAhBA,KAAgB,CAATN,MAAS,OAATA,MAAS,CACvC,GAAMO,CAAAA,OAAO,CAAGD,KAAK,CAACE,IAAN,CAAW,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAKvC,WAAW,CAACsB,GAAtB,EAAZ,CAAhB,CAEAxC,GAAG,CAAC0D,QAAJ,CAAaV,MAAb,CAAqB,CAACO,OAAtB,EAA+B3B,IAA/B,CAAoC,SAACkB,OAAD,CAAa,CAC/Cd,OAAO,CAACC,GAAR,CAAYsB,OAAZ,EACA,GAAML,CAAAA,QAAQ,CAAGnC,KAAK,CAAC4C,GAAN,CAAU,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACpB,GAAF,GAAUQ,MAAV,CAAmBF,OAAnB,CAA6Bc,CAAjC,EAAX,CAAjB,CACA5C,QAAQ,CAACkC,QAAD,CAAR,CACD,CAJD,EAKH,CAGDlB,OAAO,CAACC,GAAR,CAAYlB,KAAZ,EAjGe,qBAkG8BhB,KAAK,CAACe,QAAN,CAAe,KAAf,CAlG9B,sDAkGN+C,sBAlGM,sBAkGkBC,QAlGlB,4CAmG+B/D,KAAK,CAACe,QAAN,CAAe,KAAf,CAnG/B,uDAmGNiD,qBAnGM,sBAmGiBC,UAnGjB,4CAoG4BjE,KAAK,CAACe,QAAN,CAAe,KAAf,CApG5B,uDAoGNmD,mBApGM,sBAoGeC,SApGf,4CAqGgBnE,KAAK,CAACe,QAAN,CAAe,IAAf,CArGhB,uDAqGNsC,IArGM,sBAqGAe,YArGA,4CAsGyBpE,KAAK,CAACe,QAAN,CAAe,KAAf,CAtGzB,uDAsGNsD,iBAtGM,sBAsGaC,QAtGb,4CAuGetE,KAAK,CAACe,QAAN,CAAe,KAAf,CAvGf,uDAuGNwD,MAvGM,sBAuGEC,SAvGF,sBAwGb,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,OAAkB,IAAhB5B,CAAAA,IAAgB,OAAhBA,IAAgB,CAAVnB,IAAU,OAAVA,IAAU,CACxC0C,YAAY,CAAC,CAACvB,IAAI,CAAJA,IAAD,CAAOnB,IAAI,CAAJA,IAAP,CAAD,CAAZ,CACD,CAFD,CAGA,QAASgD,CAAAA,mBAAT,EAAgC,CAC9BJ,QAAQ,CAAC,IAAD,CAAR,CACD,CACD,QAASK,CAAAA,mBAAT,EAA+B,CAC7BZ,QAAQ,CAAC,IAAD,CAAR,CACD,CACD,QAASa,CAAAA,qBAAT,EAAiC,CAC/BX,UAAU,CAAC,IAAD,CAAV,CACD,CACD,QAASY,CAAAA,kBAAT,EAA8B,CAC5BV,SAAS,CAAC,IAAD,CAAT,CACD,CACD,QAAS/B,CAAAA,cAAT,EAA0B,CACxB+B,SAAS,CAAC,KAAD,CAAT,CACAF,UAAU,CAAC,KAAD,CAAV,CACAF,QAAQ,CAAC,KAAD,CAAR,CACAO,QAAQ,CAAC,KAAD,CAAR,CACAF,YAAY,CAAC,IAAD,CAAZ,CACD,CACH,GAAMU,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAK,CACtB,GAAMC,CAAAA,KAAK,CAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAd,CACA,GAAIF,KAAJ,CAAW,CAETnE,SAAS,CAACsE,UAAV,CAAqBH,KAArB,EACClD,IADD,CACM,SAACC,GAAD,CAAQ,CACZG,OAAO,CAACC,GAAR,CAAYJ,GAAZ,EACA,GAAGA,GAAH,CAAO,CACLN,WAAW,gCACND,QADM,MAET4D,KAAK,CAAErD,GAAG,CAACqD,KAFF,GAAX,CAIA7D,WAAW,CAAC,IAAD,CAAX,CACD,CACF,CAVD,EAWCU,KAXD,CAWO,SAAAoD,CAAC,QAAInD,CAAAA,OAAO,CAACoD,KAAR,CAAcD,CAAd,CAAJ,EAXR,EAYD,CAdD,IAeK,CACH9D,WAAW,CAAC,KAAD,CAAX,CACD,CAEF,CArBD,CAsBAtB,KAAK,CAACuC,SAAN,CAAgB,UAAK,CACnBuC,UAAU,GACX,CAFD,CAEG,EAFH,EAGA9E,KAAK,CAACuC,SAAN,CAAgB,UAAK,CACnB,GAAGlB,QAAH,CAAY,CACVH,OAAO,CAACoE,IAAR,CAAa,GAAb,EACD,CACF,CAJD,CAIG,CAACpE,OAAD,CAAUG,QAAV,CAJH,EAME,GAAMkE,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACJ,KAAD,CAAQK,QAAR,CAAqB,CAE1C5E,SAAS,CAAC6E,QAAV,CAAmBN,KAAnB,CAA0BK,QAA1B,EACC3D,IADD,CACM,SAACC,GAAD,CAAQ,CACZG,OAAO,CAACC,GAAR,CAAYJ,GAAZ,EACA,GAAGA,GAAG,CAAC4D,UAAJ,GAAmB,GAAtB,CAA0B,CACxBlB,SAAS,CAAC,IAAD,CAAT,CACAtD,OAAO,CAACoE,IAAR,CAAa,SAAb,EACD,CAHD,IAIK,CACH,KAAM,IAAIK,CAAAA,KAAJ,CAAU,qBAAV,CAAN,CACD,CAEF,CAXD,EAYC3D,KAZD,CAYO,SAACoD,CAAD,QAAOnD,CAAAA,OAAO,CAACC,GAAR,CAAYkD,CAAZ,CAAP,EAZP,EAaD,CAfD,CAgBA,GAAMQ,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACT,KAAD,CAAQK,QAAR,CAAoB,CACtC5E,SAAS,CAACiF,SAAV,CAAoBV,KAApB,CAA2BK,QAA3B,EACH3D,IADG,CACE,SAACiE,IAAD,CAAU,CACf7D,OAAO,CAACC,GAAR,CAAY4D,IAAZ,EACC,GAAGA,IAAI,CAACf,KAAR,CAAc,CACZ7D,OAAO,CAACoE,IAAR,CAAa,GAAb,EACFN,YAAY,CAACe,OAAb,CAAqB,OAArB,CAA8BD,IAAI,CAACf,KAAnC,EACA9C,OAAO,CAACC,GAAR,CAAY4D,IAAZ,EACAxE,WAAW,CAAC,IAAD,CAAX,CACAE,WAAW,gCACND,QADM,MAET4D,KAAK,CAAEW,IAAI,CAACX,KAFH,GAAX,CAIC,CACD,GAAGW,IAAI,CAACJ,UAAL,GAAoB,GAAvB,CAA2B,CACzB,KAAM,IAAIC,CAAAA,KAAJ,CAAU,qBAAV,CAAN,CACD,CACF,CAhBG,EAiBH3D,KAjBG,CAiBG,SAACoD,CAAD,QAAOnD,CAAAA,OAAO,CAACC,GAAR,CAAYkD,CAAZ,CAAP,EAjBH,EAkBD,CAnBD,CAqBF,GAAMY,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAK,CACzB1E,WAAW,CAAC,KAAD,CAAX,CACA0D,YAAY,CAACiB,UAAb,CAAwB,OAAxB,EACD,CAHD,CAKE,mBACI,YAAK,SAAS,CAAC,MAAf,uBACH,MAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAE9E,WAApC,wBACA,KAAC,MAAD,EAAQ,aAAa,CAAE6E,aAAvB,CAAsC,KAAK,CAAEzE,QAAQ,CAAC4D,KAAtD,EADA,cAEE,MAAC,MAAD,yBACC,KAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,uBACE,KAAC,KAAD,EAAO,WAAW,CAAES,WAApB,EADF,EADD,cAIG,KAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,uBACE,KAAC,QAAD,EAAU,cAAc,CAAEL,cAA1B,CAA0C,SAAS,CAAEb,mBAArD,EADF,EAJH,cAOG,KAAC,cAAD,EAAgB,IAAI,CAAC,GAArB,CAAyB,SAAS,CAAE9E,IAApC,CACA,aAAa,CAAIoG,aADjB,CAEA,WAAW,CAAEvB,eAFb,CAGE,aAAa,CAAEE,mBAHjB,CAIE,UAAU,CAAEE,kBAJd,CAKE,YAAY,CAAED,qBALhB,CAME,KAAK,CAAE5D,KANT,CAOE,UAAU,CAAEsC,cAPd,CAQE,gBAAgB,CAAEN,gBARpB,CASE,QAAQ,CAAE3B,QATZ,EAPH,GAFF,cAoBK,KAAC,aAAD,EAAe,MAAM,CAAE6C,mBAAvB,CAA4C,OAAO,CAAE9B,cAArD,CAAqE,aAAa,CAAEQ,oBAApF,EApBL,cAqBI,KAAC,eAAD,EAAiB,MAAM,CAAEoB,qBAAzB,CAAgD,OAAO,CAAE5B,cAAzD,CAAyE,cAAc,CAAEC,kBAAzF,EArBJ,cAsBK,KAAC,gBAAD,EAAkB,MAAM,CAAEyB,sBAA1B,CAAkD,OAAO,CAAE1B,cAA3D,CAA2E,YAAY,CAAEX,gBAAzF,EAtBL,cAuBI,KAAC,WAAD,EAAa,OAAO,CAAEW,cAAtB,CAAsC,MAAM,CAAEiC,iBAA9C,CAAiE,MAAM,CAAEE,MAAzE,EAvBJ,cAwBK,KAAC,UAAD,EAAY,IAAI,CAAElB,IAAlB,CAAwB,OAAO,CAAEjB,cAAjC,EAxBL,cAyBK,KAAC,MAAD,IAzBL,GADG,EADJ,CAkCD,CAED,cAAetB,CAAAA,GAAf","sourcesContent":["import Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\nimport ImagePopup from \"./PopupImage\";\nimport React from \"react\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from '../context/CurrentUserContext'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\"\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as mestoAuth from \"../mestoAuth\"\nimport InfoToolTip from \"./InfoToolTip\";\n\nfunction App() {\n \n  const [cards, setCards] = React.useState([]);\n  const history = useHistory();\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false)\n  const [userData, setUserData] = React.useState('')\n  \n  function handleUpdateUser({name, about}){\n \n      api.addUserId({name, about}).then((res) => {\n        setCurrentUser({\n          name: res.name, about:res.about, avatar: res.avatar})\n      }).catch((res)=>{\n        console.log(res)\n      }).finally(()=>{\n        closeAllPopups()\n      });\n    };\n\n    \n    function handleUpdateAvatar({avatar}){\n \n      api.addAvatarId({avatar}).then((res) => {\n        setCurrentUser({\n   avatar: res.avatar, name: res.name, about:res.about})\n      }).catch((res)=>{\n        console.log(res)\n      }).finally(()=>{\n        closeAllPopups()\n      });\n    };\n\n \n  React.useEffect(() => {\n    api.getUserId().then((res) => {\n      if (!loggedIn) {\n        return;\n      }\n      setCurrentUser({\n        name: res.name,\n        about: res.about,\n        avatar: res.avatar,\n        _id: res._id\n      })\n      \n    }).catch((res)=>{\n      console.log(res)\n    });\n  }, [loggedIn]);\n\n\n\n\n  React.useEffect(() => {\n    api.getInitialCards().then((item) => {\n      if (!loggedIn) {\n        return;\n      }\n      setCards(item);\n      console.log(item)\n    }).catch((res)=>{\n      console.log(res)\n    });\n  }, [loggedIn]);\n  \nfunction handleAddPlaceSubmit({name, link}){\n  api.addCards({name, link}).then(newCard => {\n    setCards([newCard, ...cards]);\n  }).catch((res)=>{\n    console.log(res)\n  }).finally(()=>{\n    closeAllPopups()\n  });;\n};\n\n\nfunction handleDeleteCard({cardId}) {\n  \n  api.deleteCard(cardId).then(() => {\n    const newCards = cards.filter(card => card._id !== cardId);\n    setCards(newCards);\n  });\n}\n\n\n  function handleCardLike({likes, cardId}) {\n    const isLiked = likes.some(i => i === currentUser._id);\n  \n    api.likeCard(cardId, !isLiked).then((newCard) => {\n      console.log(isLiked)\n      const newCards = cards.map(c => c._id === cardId ? newCard : c);\n      setCards(newCards);\n    });\n}\n\n\nconsole.log(cards)\n  const [isEditProfilePopupOpen, editOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, avatarOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, placeOpen] = React.useState(false);\n  const [card, selectedCard] = React.useState(null);\n  const [isInfoToolTipOpen, toolOpen] = React.useState(false);\n  const [status, setStatus] = React.useState(false)\n  const handleCardClick = ({link, name}) => {\n    selectedCard({link, name});\n  };\n  function handleInfoToolClick () {\n    toolOpen(true)\n  }\n  function handleEditEditClick() {\n    editOpen(true);\n  }\n  function handleEditAvatarClick() {\n    avatarOpen(true);\n  }\n  function handleEditAddClick() {\n    placeOpen(true);\n  }\n  function closeAllPopups() {\n    placeOpen(false);\n    avatarOpen(false);\n    editOpen(false);\n    toolOpen(false)\n    selectedCard(null);\n  }\nconst tokenCheck = () =>{\n  const token = localStorage.getItem('token')\n  if (token) {\n    \n    mestoAuth.getContent(token)\n    .then((res) =>{\n      console.log(res)\n      if(res){\n        setUserData({\n          ...userData,\n          email: res.email,\n        })\n        setLoggedIn(true)\n      }\n    })\n    .catch(e => console.error(e))\n  }\n  else {\n    setLoggedIn(false)\n  }\n  \n}\nReact.useEffect(() =>{\n  tokenCheck();\n}, [])\nReact.useEffect(() =>{\n  if(loggedIn){\n    history.push('/')\n  }\n}, [history, loggedIn])\n\n  const handleRegister = (email, password) => {\n    \n    mestoAuth.register(email, password)\n    .then((res) =>{\n      console.log(res)\n      if(res.statusCode !== 400){\n        setStatus(true)\n        history.push('/signin')\n      }\n      else {\n        throw new Error('Что-то пошло не так')\n      }\n     \n    })\n    .catch((e) => console.log(e));\n  }\n  const handleLogin = (email, password) =>{\n    mestoAuth.authorize(email, password)\n.then((data) => {\n console.log(data)\n  if(data.token){\n    history.push('/')\n  localStorage.setItem('token', data.token)\n  console.log(data)\n  setLoggedIn(true)\n  setUserData({\n    ...userData,\n    email: data.email,\n  })\n  }\n  if(data.statusCode === 400){\n    throw new Error('Что-то пошло не так')\n  }\n})\n.catch((e) => console.log(e));\n  }\n\nconst handleSignOut = () =>{\n  setLoggedIn(false)\n  localStorage.removeItem('token')\n}\n\n  return (\n      <div className=\"page\">\n   <CurrentUserContext.Provider value={currentUser}>\n   <Header handleSignOut={handleSignOut} email={userData.email}/>\n     <Switch>\n      <Route path=\"/signin\" >\n        <Login handleLogin={handleLogin}/>  \n     </Route>\n        <Route path=\"/signup\" >\n          <Register handleRegister={handleRegister} showPopup={handleInfoToolClick}/>\n        </Route>\n        <ProtectedRoute path=\"/\" component={Main} \n        handleSignOut = {handleSignOut}\n        onCardClick={handleCardClick}\n          onEditProfile={handleEditEditClick}\n          onAddPlace={handleEditAddClick}\n          onEditAvatar={handleEditAvatarClick}\n          cards={cards}\n          onCardLike={handleCardLike}\n          handleDeleteCard={handleDeleteCard}\n          loggedIn={loggedIn}/>\n     </Switch>\n        <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onUpdatePlace={handleAddPlaceSubmit}/>\n       <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar}/>\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser}/>\n       <InfoToolTip onClose={closeAllPopups} isOpen={isInfoToolTipOpen} status={status}/>\n        <ImagePopup card={card} onClose={closeAllPopups} />\n        <Footer />\n       \n        </CurrentUserContext.Provider>\n        \n      </div>\n   \n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}