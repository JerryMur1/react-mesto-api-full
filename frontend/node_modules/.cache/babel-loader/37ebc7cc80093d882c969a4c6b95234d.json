{"ast":null,"code":"var _jsxFileName = \"/Users/dmitrii/react-mesto-api-full/frontend/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\nimport ImagePopup from \"./PopupImage\";\nimport React from \"react\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from '../context/CurrentUserContext';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as mestoAuth from \"../mestoAuth\";\nimport InfoToolTip from \"./InfoToolTip\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [cards, setCards] = React.useState([]);\n  const history = useHistory();\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [userData, setUserData] = React.useState('');\n\n  function handleUpdateUser({\n    name,\n    about\n  }) {\n    api.addUserId({\n      name,\n      about\n    }).then(res => {\n      setCurrentUser({\n        name: res.name,\n        about: res.about,\n        avatar: res.avatar\n      });\n    }).catch(res => {\n      console.log(res);\n    }).finally(() => {\n      closeAllPopups();\n    });\n  }\n\n  ;\n\n  function handleUpdateAvatar({\n    avatar\n  }) {\n    api.addAvatarId({\n      avatar\n    }).then(res => {\n      setCurrentUser({\n        avatar: res.avatar,\n        name: res.name,\n        about: res.about\n      });\n    }).catch(res => {\n      console.log(res);\n    }).finally(() => {\n      closeAllPopups();\n    });\n  }\n\n  ;\n  React.useEffect(() => {\n    api.getUserId().then(res => {\n      if (!loggedIn) {\n        return;\n      }\n\n      setCurrentUser({\n        name: res.name,\n        about: res.about,\n        avatar: res.avatar,\n        _id: res._id\n      });\n    }).catch(res => {\n      console.log(res);\n    });\n  }, [loggedIn]);\n  React.useEffect(() => {\n    api.getInitialCards().reverse().then(item => {\n      if (!loggedIn) {\n        return;\n      }\n\n      setCards(item);\n      console.log(item);\n    }).catch(res => {\n      console.log(res);\n    });\n  }, [loggedIn]);\n\n  function handleAddPlaceSubmit({\n    name,\n    link\n  }) {\n    api.addCards({\n      name,\n      link\n    }).then(newCard => {\n      setCards([newCard, ...cards]);\n    }).catch(res => {\n      console.log(res);\n    }).finally(() => {\n      closeAllPopups();\n    });\n    ;\n  }\n\n  ;\n\n  function handleDeleteCard({\n    cardId\n  }) {\n    api.deleteCard(cardId).then(() => {\n      const newCards = cards.filter(card => card._id !== cardId);\n      setCards(newCards);\n    });\n  }\n\n  function handleCardLike({\n    likes,\n    cardId\n  }) {\n    const isLiked = likes.some(i => i === currentUser._id);\n    api.likeCard(cardId, !isLiked).then(newCard => {\n      console.log(isLiked);\n      const newCards = cards.map(c => c._id === cardId ? newCard : c);\n      setCards(newCards);\n    });\n  }\n\n  console.log(cards);\n  const [isEditProfilePopupOpen, editOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, avatarOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, placeOpen] = React.useState(false);\n  const [card, selectedCard] = React.useState(null);\n  const [isInfoToolTipOpen, toolOpen] = React.useState(false);\n  const [status, setStatus] = React.useState(false);\n\n  const handleCardClick = ({\n    link,\n    name\n  }) => {\n    selectedCard({\n      link,\n      name\n    });\n  };\n\n  function handleInfoToolClick() {\n    toolOpen(true);\n  }\n\n  function handleEditEditClick() {\n    editOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    avatarOpen(true);\n  }\n\n  function handleEditAddClick() {\n    placeOpen(true);\n  }\n\n  function closeAllPopups() {\n    placeOpen(false);\n    avatarOpen(false);\n    editOpen(false);\n    toolOpen(false);\n    selectedCard(null);\n  }\n\n  const tokenCheck = () => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      mestoAuth.getContent(token).then(res => {\n        console.log(res);\n\n        if (res) {\n          setUserData({ ...userData,\n            email: res.email\n          });\n          setLoggedIn(true);\n        }\n      }).catch(e => console.error(e));\n    } else {\n      setLoggedIn(false);\n    }\n  };\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, []);\n  React.useEffect(() => {\n    if (loggedIn) {\n      history.push('/');\n    }\n  }, [history, loggedIn]);\n\n  const handleRegister = (email, password) => {\n    mestoAuth.register(email, password).then(res => {\n      console.log(res);\n\n      if (res.statusCode !== 400) {\n        setStatus(true);\n        history.push('/signin');\n      } else {\n        throw new Error('Что-то пошло не так');\n      }\n    }).catch(e => console.log(e));\n  };\n\n  const handleLogin = (email, password) => {\n    mestoAuth.authorize(email, password).then(data => {\n      console.log(data);\n\n      if (data.token) {\n        history.push('/');\n        localStorage.setItem('token', data.token);\n        console.log(data);\n        setLoggedIn(true);\n        setUserData({ ...userData,\n          email: data.email\n        });\n      }\n\n      if (data.statusCode === 400) {\n        throw new Error('Что-то пошло не так');\n      }\n    }).catch(e => console.log(e));\n  };\n\n  const handleSignOut = () => {\n    setLoggedIn(false);\n    localStorage.removeItem('token');\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n      value: currentUser,\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        handleSignOut: handleSignOut,\n        email: userData.email\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(Switch, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: \"/signin\",\n          children: /*#__PURE__*/_jsxDEV(Login, {\n            handleLogin: handleLogin\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 9\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/signup\",\n          children: /*#__PURE__*/_jsxDEV(Register, {\n            handleRegister: handleRegister,\n            showPopup: handleInfoToolClick\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 227,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n          path: \"/\",\n          component: Main,\n          handleSignOut: handleSignOut,\n          onCardClick: handleCardClick,\n          onEditProfile: handleEditEditClick,\n          onAddPlace: handleEditAddClick,\n          onEditAvatar: handleEditAvatarClick,\n          cards: cards,\n          onCardLike: handleCardLike,\n          handleDeleteCard: handleDeleteCard,\n          loggedIn: loggedIn\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 6\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        onClose: closeAllPopups,\n        onUpdatePlace: handleAddPlaceSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        onClose: closeAllPopups,\n        onUpdateAvatar: handleUpdateAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        onClose: closeAllPopups,\n        onUpdateUser: handleUpdateUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(InfoToolTip, {\n        onClose: closeAllPopups,\n        isOpen: isInfoToolTipOpen,\n        status: status\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n        card: card,\n        onClose: closeAllPopups\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 219,\n    columnNumber: 7\n  }, this);\n}\n\n_s(App, \"/z+bfa3iWKbifZ6AhHw8cmV4J8A=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/dmitrii/react-mesto-api-full/frontend/src/components/App.js"],"names":["Main","Footer","Header","ImagePopup","React","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Route","Switch","useHistory","Login","Register","ProtectedRoute","mestoAuth","InfoToolTip","App","cards","setCards","useState","history","currentUser","setCurrentUser","loggedIn","setLoggedIn","userData","setUserData","handleUpdateUser","name","about","addUserId","then","res","avatar","catch","console","log","finally","closeAllPopups","handleUpdateAvatar","addAvatarId","useEffect","getUserId","_id","getInitialCards","reverse","item","handleAddPlaceSubmit","link","addCards","newCard","handleDeleteCard","cardId","deleteCard","newCards","filter","card","handleCardLike","likes","isLiked","some","i","likeCard","map","c","isEditProfilePopupOpen","editOpen","isEditAvatarPopupOpen","avatarOpen","isAddPlacePopupOpen","placeOpen","selectedCard","isInfoToolTipOpen","toolOpen","status","setStatus","handleCardClick","handleInfoToolClick","handleEditEditClick","handleEditAvatarClick","handleEditAddClick","tokenCheck","token","localStorage","getItem","getContent","email","e","error","push","handleRegister","password","register","statusCode","Error","handleLogin","authorize","data","setItem","handleSignOut","removeItem"],"mappings":"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","sourcesContent":["import Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport Header from \"./Header\";\nimport ImagePopup from \"./PopupImage\";\nimport React from \"react\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from '../context/CurrentUserContext'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Route, Switch, useHistory } from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\"\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as mestoAuth from \"../mestoAuth\"\nimport InfoToolTip from \"./InfoToolTip\";\n\n\nfunction App() {\n \n  const [cards, setCards] = React.useState([]);\n  const history = useHistory();\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false)\n  const [userData, setUserData] = React.useState('')\n  \n  function handleUpdateUser({name, about}){\n \n      api.addUserId({name, about}).then((res) => {\n        setCurrentUser({\n          name: res.name, about:res.about, avatar: res.avatar})\n      }).catch((res)=>{\n        console.log(res)\n      }).finally(()=>{\n        closeAllPopups()\n      });\n    };\n\n    \n    function handleUpdateAvatar({avatar}){\n \n      api.addAvatarId({avatar}).then((res) => {\n        setCurrentUser({\n   avatar: res.avatar, name: res.name, about:res.about})\n      }).catch((res)=>{\n        console.log(res)\n      }).finally(()=>{\n        closeAllPopups()\n      });\n    };\n\n \n  React.useEffect(() => {\n    api.getUserId().then((res) => {\n      if (!loggedIn) {\n        return;\n      }\n      setCurrentUser({\n        name: res.name,\n        about: res.about,\n        avatar: res.avatar,\n        _id: res._id\n      })\n      \n    }).catch((res)=>{\n      console.log(res)\n    });\n  }, [loggedIn]);\n\n\n\n\n  React.useEffect(() => {\n    api.getInitialCards().reverse().then((item) => {\n      if (!loggedIn) {\n        return;\n      }\n      setCards(item);\n      console.log(item)\n    }).catch((res)=>{\n      console.log(res)\n    });\n  }, [loggedIn]);\n  \nfunction handleAddPlaceSubmit({name, link}){\n  api.addCards({name, link}).then(newCard => {\n    setCards([newCard, ...cards]);\n  }).catch((res)=>{\n    console.log(res)\n  }).finally(()=>{\n    closeAllPopups()\n  });;\n};\n\n\nfunction handleDeleteCard({cardId}) {\n  \n  api.deleteCard(cardId).then(() => {\n    const newCards = cards.filter(card => card._id !== cardId);\n    setCards(newCards);\n  });\n}\n\n\n  function handleCardLike({likes, cardId}) {\n    const isLiked = likes.some(i => i === currentUser._id);\n  \n    api.likeCard(cardId, !isLiked).then((newCard) => {\n      console.log(isLiked)\n      const newCards = cards.map(c => c._id === cardId ? newCard : c);\n      setCards(newCards);\n    });\n}\n\n\nconsole.log(cards)\n  const [isEditProfilePopupOpen, editOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, avatarOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, placeOpen] = React.useState(false);\n  const [card, selectedCard] = React.useState(null);\n  const [isInfoToolTipOpen, toolOpen] = React.useState(false);\n  const [status, setStatus] = React.useState(false)\n  const handleCardClick = ({link, name}) => {\n    selectedCard({link, name});\n  };\n  function handleInfoToolClick () {\n    toolOpen(true)\n  }\n  function handleEditEditClick() {\n    editOpen(true);\n  }\n  function handleEditAvatarClick() {\n    avatarOpen(true);\n  }\n  function handleEditAddClick() {\n    placeOpen(true);\n  }\n  function closeAllPopups() {\n    placeOpen(false);\n    avatarOpen(false);\n    editOpen(false);\n    toolOpen(false)\n    selectedCard(null);\n  }\nconst tokenCheck = () =>{\n  const token = localStorage.getItem('token')\n  if (token) {\n    \n    mestoAuth.getContent(token)\n    .then((res) =>{\n      console.log(res)\n      if(res){\n        setUserData({\n          ...userData,\n          email: res.email,\n        })\n        setLoggedIn(true)\n      }\n    })\n    .catch(e => console.error(e))\n  }\n  else {\n    setLoggedIn(false)\n  }\n  \n}\nReact.useEffect(() =>{\n  tokenCheck();\n}, [])\nReact.useEffect(() =>{\n  if(loggedIn){\n    history.push('/')\n  }\n}, [history, loggedIn])\n\n  const handleRegister = (email, password) => {\n    \n    mestoAuth.register(email, password)\n    .then((res) =>{\n      console.log(res)\n      if(res.statusCode !== 400){\n        setStatus(true)\n        history.push('/signin')\n      }\n      else {\n        throw new Error('Что-то пошло не так')\n      }\n     \n    })\n    .catch((e) => console.log(e));\n  }\n  const handleLogin = (email, password) =>{\n    mestoAuth.authorize(email, password)\n.then((data) => {\n console.log(data)\n  if(data.token){\n    history.push('/')\n  localStorage.setItem('token', data.token)\n  console.log(data)\n  setLoggedIn(true)\n  setUserData({\n    ...userData,\n    email: data.email,\n  })\n  }\n  if(data.statusCode === 400){\n    throw new Error('Что-то пошло не так')\n  }\n})\n.catch((e) => console.log(e));\n  }\n\nconst handleSignOut = () =>{\n  setLoggedIn(false)\n  localStorage.removeItem('token')\n}\n\n  return (\n      <div className=\"page\">\n   <CurrentUserContext.Provider value={currentUser}>\n   <Header handleSignOut={handleSignOut} email={userData.email}/>\n     <Switch>\n      <Route path=\"/signin\" >\n        <Login handleLogin={handleLogin}/>  \n     </Route>\n        <Route path=\"/signup\" >\n          <Register handleRegister={handleRegister} showPopup={handleInfoToolClick}/>\n        </Route>\n        <ProtectedRoute path=\"/\" component={Main} \n        handleSignOut = {handleSignOut}\n        onCardClick={handleCardClick}\n          onEditProfile={handleEditEditClick}\n          onAddPlace={handleEditAddClick}\n          onEditAvatar={handleEditAvatarClick}\n          cards={cards}\n          onCardLike={handleCardLike}\n          handleDeleteCard={handleDeleteCard}\n          loggedIn={loggedIn}/>\n     </Switch>\n        <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onUpdatePlace={handleAddPlaceSubmit}/>\n       <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar}/>\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser}/>\n       <InfoToolTip onClose={closeAllPopups} isOpen={isInfoToolTipOpen} status={status}/>\n        <ImagePopup card={card} onClose={closeAllPopups} />\n        <Footer />\n       \n        </CurrentUserContext.Provider>\n        \n      </div>\n   \n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}